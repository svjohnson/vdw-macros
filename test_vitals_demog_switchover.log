1                                                          The SAS System                            13:42 Tuesday, February 1, 2011

NOTE: Copyright (c) 2002-2008 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.2 (TS1M0) 
      Licensed to GROUP HEALTH COOPERATIVE OF PUGET SOUND, Site 70007081.
NOTE: This session is executing on the XP_PRO  platform.



NOTE: SAS initialization used:
      real time           0.28 seconds
      cpu time            0.21 seconds
      
1          /*********************************************
2          * Roy Pardee
3          * Group Health Research Institute
4          * (206) 287-2078
5          * pardee.r@ghc.org
6          *
7          * c:\Documents and Settings\pardre1\My Documents\vdw\macros\test_vitals_demog_switchover.sas
8          *
9          *
10         *********************************************/
11         
12         %include "\\home\pardre1\SAS\Scripts\remoteactivate.sas" ;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

NOTE: Libref S was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: \\ctrhs-sas\sasuser\pardre1
NOTE: Remote signon to CHSDWSAS commencing (SAS Release 9.02.01M0P020508).
NOTE: Script file 'tcpwin.scr' entered.
NOTE: Logged onto Windows... Starting remote SAS now.
NOTE: SAS/CONNECT conversation established.
NOTE: Unable to open SASUSER.PROFILE. WORK.PROFILE will be opened instead.
NOTE: All profile changes will be lost at the end of the session.
NOTE: Copyright (c) 2002-2008 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.2 (TS1M0) 
      Licensed to GROUP HEALTH COOPERATIVE OF PUGET SOUND, Site 70007082.
NOTE: This session is executing on the NET_SRV  platform.



NOTE: SAS initialization used:
      real time           0.18 seconds
      cpu time            0.18 seconds
      
NOTE: Remote signon to CHSDWSAS complete.
2                                                          The SAS System                            13:42 Tuesday, February 1, 2011

NOTE: Remote submit to CHSDWSAS commencing.
1    %make_spm_comment(&CurrFile) ;

NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: The file _COMMENT is:
      Filename=\\ctrhs-sas\scratch\_TD98912\spm_comment.txt,
      RECFM=V,LRECL=256,File Size (bytes)=0,
      Last Modified=01Feb2011:13:42:57,
      Create Time=01Feb2011:13:42:57

NOTE: 1 record was written to the file _COMMENT.
      The minimum record length was 90.
      The maximum record length was 90.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

2    
3    ***********************;
4    ** Set the typical libnames... ;
5    ** SAS recommends *against* UNCs (!). ;
6    %**let DWROOT = \\ctrhs-sas\warehouse\SasData\ ;
7    %let DWROOT = e:\warehouse\SasData\ ;
8    libname consumer  "&DWROOT.Consumer" ;
NOTE: Libref CONSUMER was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Consumer
9    libname chsid     "&DWROOT.CHSID" ;
NOTE: Libref CHSID was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\CHSID
10   libname demogs    "&DWROOT.Consumer Demographics" ;
NOTE: Libref DEMOGS was successfully assigned as follows: 
3                                                          The SAS System                            13:42 Tuesday, February 1, 2011

      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Consumer Demographics
11   libname enroll    "&DWROOT.Enrollment" ;
NOTE: Libref ENROLL was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Enrollment
12   libname nac       "&DWROOT.Cancer\Naaccr" ;
NOTE: Libref NAC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Cancer\Naaccr
13   libname naaccr    "&DWROOT.Cancer\Naaccr" ;
NOTE: Libname NAACCR refers to the same physical library as NAC.
NOTE: Libref NAACCR was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Cancer\Naaccr
14   libname baseline  "&DWROOT.Baseline" ;
NOTE: Libref BASELINE was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Baseline
15   libname arpa      "&DWROOT.arpa" ;
NOTE: Library ARPA does not exist.
16   libname mbhist    "&DWROOT.mbhist" ;
NOTE: Libref MBHIST was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\mbhist
17   libname mbcurr    "&DWROOT.mbcurr" ;
NOTE: Libref MBCURR was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\mbcurr
18   libname claims    "&DWROOT.claims" ;
NOTE: Libref CLAIMS was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\claims
19   libname death     "&DWROOT.death" ;
NOTE: Libref DEATH was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\death
20   libname hosp      "&DWROOT.Hospital" ;
NOTE: Libref HOSP was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Hospital
21   libname VDW       "&DWROOT.CRN_VDW" ;
NOTE: Libref VDW was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\CRN_VDW
22   libname hosps     "&DWROOT.hospital" ;
NOTE: Libname HOSPS refers to the same physical library as HOSP.
NOTE: Libref HOSPS was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\Hospital
23   libname rx        "&DWROOT.rx" ;
NOTE: Libref RX was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\rx
4                                                          The SAS System                            13:42 Tuesday, February 1, 2011

24   libname lab       "&DWROOT.lab" ;
NOTE: Libref LAB was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\lab
25   libname cmd       "&DWROOT.cmd" ;
NOTE: Libref CMD was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\cmd
26   libname ambvis    "&DWROOT.ambulatoryvisits" ;
NOTE: Libref AMBVIS was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: e:\warehouse\SasData\ambulatoryvisits
27   libname s         "j:\sasuser\pardre1" ;
NOTE: Libref S was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: j:\sasuser\pardre1
28   
29   footnote "Program file: &CurrFile " ;
30   
31   
32   options linesize = 150 nocenter msglevel = i NOOVP formchar='|-++++++++++=|-/|<>*' ; ** dsoptions="note2err" NOSQLREMERGE ;
33   
34   /*
35   Getting ready to switch over to v3 on demog & vitals.  What macros need to be touched?
36   
37   macros touching demog:
38     GetRxRiskForPeople      *
39     cleanvitals             *
40     GetKidBMIPercentiles    *
41     make_inclusion_table    *
42     GetAdultBMI             *
43     BMI_adult_macro         * (called by GetAdultBMI).
44   
45   macros touching vitals:
46     GetVitalSignsForPeople
47     cleanvitals
48     GetKidBMIPercentiles
49   
50   
51   */
52   
53   %macro get_test_kids(n = 300, outset = s.test_kids) ;
54     proc sql outobs = &n nowarn ;
55       create table &outset as
56       select mrn
57       from vdw.demog
58       where birth_date gt '13jan1994'd and
59             substr(mrn, 4, 1) = 'K'
60       ;
61     quit ;
62   %mend get_test_kids ;
63   
64   %macro get_test_cohort(n = 300, outset = s.test_cohort) ;
65     proc sql outobs = &n nowarn ;
5                                                          The SAS System                            13:42 Tuesday, February 1, 2011

66       create table &outset as
67       select mrn
68       from vdw.demog
69       where substr(mrn, 4, 1) = 'A'
70       ;
71     quit ;
72   %mend get_test_cohort ;
73   
74   /*
75   %get_test_kids ;
76   %get_test_cohort ;
77   */
78   
79   %include "\\mlt1q0\c$\Documents and Settings\pardre1\My Documents\vdw\macros\StdVars.sas" ;
NOTE: Libref __VDW was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: \\ctrhs-sas\warehouse\sasdata\crn_vdw
167  %include "\\mlt1q0\c$\Documents and Settings\pardre1\My Documents\vdw\macros\standard_macros.sas" ;
4978  
4979  %macro no_changes_needed ;
4980    data cohort ;
4981      set s.test_cohort s.test_kids ;
4982      idate = '20jun2007'd ;
4983      format idate mmddyy10. ;
4984    run ;
4985  
4986  
4987    %GetRxRiskForPeople(InFile = cohort, OutFile = s.test_rxriskforpeople_v3, IndexDt = idate) ;
4988  
4989  
4990    options dsoptions="zaa?" ;
4991    %GetKidBMIPercentiles(Inset = s.test_kids /* Dset of MRNs on whom you want kid BMI recs */
4992                            , OutSet = s.test_kid_bmis
4993                            , StartDt = 01jan2009
4994                            , EndDt = &sysdate9
4995                            ) ;
4996  
4997    ** While no changes were **necessary** here, I did take the opportunity to change from a "select *" to a ;
4998    ** specific list of relevant variables to grab out of the vitals table. ;
4999    %GetAdultBMI(people = s.test_cohort, outset = s.test_adult_bmi, StartDt = '01jan2006'd, EndDt = '30jun2007'd) ;
5000  
5001    %CleanVitals(OutLib = mac, Clean=Y, Dirty=Y, Report=Y, Limits=Y);
5002  
5003  %mend no_changes_needed ;
5004  
5005  
5006  %macro needed_changes ;
5007    ods html path = "\\groups\data\CTRHS\Crn\S D R C\VDW\Macros\" (URL=NONE)
5008             body = "test_make_inclusion_table.html"
5009             (title = "test_make_inclusion_table output")
5010              ;
5011  
5012  
5013    options mprint ;
6                                                          The SAS System                            13:42 Tuesday, February 1, 2011

5014  
5015    %make_inclusion_table(cohort = vdw.demog) ;
5016  
5017    run ;
5018    ods html close ;
5019  %mend needed_changes ;
5020  
5021  libname mac '\\ctrhs-sas\SASUser\pardre1\vdw\macro_testing' ;
NOTE: Libref MAC was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: \\ctrhs-sas\SASUser\pardre1\vdw\macro_testing
5022  
5023  
5024  %needed_changes ;
NOTE: Writing HTML Body file: test_make_inclusion_table.html
MPRINT(MAKE_INCLUSION_TABLE):   proc format ;
MPRINT(MAKE_INCLUSION_TABLE):   value $Hispani 'Y' = '1 Hispanic or Latino' 'N' = '2 Not Hispanic or Latino' 'U' , ' ' , '' , 
Missing = '3 Unknown 
(Individuals not reporting ethnicity)' ;
NOTE: Format $HISPANI has been output.
MPRINT(MAKE_INCLUSION_TABLE):   value $Gender 'M' = 'Males' 'F' = 'Females' Other = 'Unknown or Not Reported' ;
NOTE: Format $GENDER has been output.
MPRINT(MAKE_INCLUSION_TABLE):   value $Race 'IN' = '1 American Indian/Alaska Native' 'AS' = '2 Asian' 'HP' = '3 Native Hawaiian or 
Other Pacific 
Islander' 'BA' = '4 Black or African American' 'WH' = '5 White' 'MU' = '6 More than one race' '01' = '5 White' '02' = '4 Black or 
African American' 
'03' = '1 American Indian/Alaska Native' '04' , '05' , '06' , '08' , '09' , '10' , '11' , '12' , '13' , '14' , '96' = '2 Asian' 
'07' , '20' , '21' , 
'22' , '25' , '26' , '27' , '28' , '30' , '31' , '32' , '97' = '3 Native Hawaiian or Other Pacific Islander' '-1' = '6 More than 
one race' Other = '7 
Unknown or Not Reported' ;
NOTE: Format $RACE has been output.
MPRINT(MAKE_INCLUSION_TABLE):   quit ;

NOTE: PROCEDURE FORMAT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
      

MPRINT(MAKE_INCLUSION_TABLE):   ** TODO: the macro should check for the presence of gender, race1 and hispanic, and only pull them 
if necessary. ;
MPRINT(MAKE_INCLUSION_TABLE):   proc sql ;
MPRINT(MAKE_INCLUSION_TABLE):   create table _reportable as select d.mrn, d.race1 as race label = "Racial Category" , d.hispanic 
label = "Ethnic 
Category" , d.gender label = "Sex/Gender" from __vdw.demog_view as d INNER JOIN vdw.demog as c on d.mrn = c.mrn ;
NOTE: Table WORK._REPORTABLE created, with 3307134 rows and 4 columns.

MPRINT(MAKE_INCLUSION_TABLE):   create table genders (gender char(1)) ;
NOTE: Table WORK.GENDERS created, with 0 rows and 1 columns.
MPRINT(MAKE_INCLUSION_TABLE):   insert into genders(gender) values ('F') ;
NOTE: 1 row was inserted into WORK.GENDERS.

MPRINT(MAKE_INCLUSION_TABLE):   insert into genders(gender) values ('M') ;
NOTE: 1 row was inserted into WORK.GENDERS.
7                                                          The SAS System                            13:42 Tuesday, February 1, 2011


MPRINT(MAKE_INCLUSION_TABLE):   insert into genders(gender) values ('U') ;
NOTE: 1 row was inserted into WORK.GENDERS.

MPRINT(MAKE_INCLUSION_TABLE):   create table races(race char(2)) ;
NOTE: Table WORK.RACES created, with 0 rows and 1 columns.
MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('IN') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('AS') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('HP') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('BA') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('WH') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('MU') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('01') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('02') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('03') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('04') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('  ') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('97') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into races(race) values ('-1') ;
NOTE: 1 row was inserted into WORK.RACES.

MPRINT(MAKE_INCLUSION_TABLE):   create table ethnicities(hispanic char(1)) ;
NOTE: Table WORK.ETHNICITIES created, with 0 rows and 1 columns.
MPRINT(MAKE_INCLUSION_TABLE):   insert into ethnicities(hispanic) values('Y') ;
NOTE: 1 row was inserted into WORK.ETHNICITIES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into ethnicities(hispanic) values('N') ;
NOTE: 1 row was inserted into WORK.ETHNICITIES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into ethnicities(hispanic) values('U') ;
8                                                          The SAS System                            13:42 Tuesday, February 1, 2011

NOTE: 1 row was inserted into WORK.ETHNICITIES.

MPRINT(MAKE_INCLUSION_TABLE):   insert into ethnicities(hispanic) values(' ') ;
NOTE: 1 row was inserted into WORK.ETHNICITIES.

MPRINT(MAKE_INCLUSION_TABLE):   create table class_levels as select gender, race, hispanic from genders CROSS JOIN races CROSS JOIN 
ethnicities ;
NOTE: The execution of this query involves performing one or more Cartesian product joins that can not be optimized.
NOTE: Table WORK.CLASS_LEVELS created, with 156 rows and 3 columns.

MPRINT(MAKE_INCLUSION_TABLE):   quit ;
NOTE: PROCEDURE SQL used (Total process time):
      real time           22.37 seconds
      cpu time            11.43 seconds
      

MPRINT(MAKE_INCLUSION_TABLE):   title1 "Inclusion Enrollment Report" ;
MPRINT(MAKE_INCLUSION_TABLE):   title2 "PART A TOTAL ENROLLMENT REPORT" ;
MPRINT(MAKE_INCLUSION_TABLE):   proc tabulate data = _reportable missing format = comma15.0 order = formatted classdata = 
class_levels ;
MPRINT(MAKE_INCLUSION_TABLE):   class hispanic race gender ;
MPRINT(MAKE_INCLUSION_TABLE):   keylabel N = ' ' ;
MPRINT(MAKE_INCLUSION_TABLE):   tables hispanic all='Total of all subjects:', gender all = 'Total' / printmiss misstext = '0' box = 
'Ethnic Category' 
;
MPRINT(MAKE_INCLUSION_TABLE):   tables race all='Total of all subjects:', gender all = 'Total' / printmiss misstext = '0' box = 
'Racial Categories' ;
MPRINT(MAKE_INCLUSION_TABLE):   format race $race. hispanic $hispani. gender $gender. ;
MPRINT(MAKE_INCLUSION_TABLE):   quit ;

NOTE: Multiple concurrent threads will be used to summarize data.
NOTE: There were 3307134 observations read from the data set WORK._REPORTABLE.
NOTE: There were 156 observations read from the data set WORK.CLASS_LEVELS.
NOTE: The PROCEDURE TABULATE printed pages 1-2.
NOTE: PROCEDURE TABULATE used (Total process time):
      real time           2.67 seconds
      cpu time            5.75 seconds
      

MPRINT(MAKE_INCLUSION_TABLE):   title2 "PART B HISPANIC ENROLLMENT REPORT" ;
MPRINT(MAKE_INCLUSION_TABLE):   proc tabulate data = _reportable missing format = comma15.0 order = formatted classdata = 
class_levels ;
MPRINT(MAKE_INCLUSION_TABLE):   class hispanic race gender ;
MPRINT(MAKE_INCLUSION_TABLE):   keylabel N = ' ' ;
MPRINT(MAKE_INCLUSION_TABLE):   tables race all='Total of Hispanics or Latinos:', gender all = 'Total' / printmiss misstext = '0' 
box = 'Racial 
Categories' ;
MPRINT(MAKE_INCLUSION_TABLE):   format race $race. hispanic $hispani. gender $gender. ;
MPRINT(MAKE_INCLUSION_TABLE):   where put(hispanic, $hispani.) = '1 Hispanic or Latino' ;
MPRINT(MAKE_INCLUSION_TABLE):   quit ;

NOTE: Multiple concurrent threads will be used to summarize data.
NOTE: There were 11100 observations read from the data set WORK._REPORTABLE.
      WHERE PUT(hispanic, $HISPANI47.)='1 Hispanic or Latino';
9                                                          The SAS System                            13:42 Tuesday, February 1, 2011

NOTE: There were 39 observations read from the data set WORK.CLASS_LEVELS.
      WHERE PUT(hispanic, $HISPANI47.)='1 Hispanic or Latino';
NOTE: The PROCEDURE TABULATE printed page 3.
NOTE: PROCEDURE TABULATE used (Total process time):
      real time           4.06 seconds
      cpu time            3.28 seconds
      

MPRINT(NEEDED_CHANGES):   ;
MPRINT(NEEDED_CHANGES):   run ;
MPRINT(NEEDED_CHANGES):   ods html close ;
5025  
5026  %macro not_yet_tested ;
5027  
5028  
5029  
5030  
5031  
5032  %mend not_yet_tested ;
NOTE: Remote submit to CHSDWSAS complete.
NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           31.11 seconds
      cpu time            0.48 seconds
      
