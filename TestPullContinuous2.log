1                                                          The SAS System                            11:40 Tuesday, November 8, 2005

NOTE: Unable to open SASUSER.REGSTRY. WORK.REGSTRY will be opened instead.
NOTE: All registry changes will be lost at the end of the session.

NOTE: Copyright (c) 2002-2003 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) 9.1 (TS1M3)
      Licensed to GROUP HEALTH COOPERATIVE OF PUGET SOUND, Site 0009688001.
NOTE: This session is executing on the XP_PRO  platform.



NOTE: This installation is running SAS/STAT hot fix bundle SAS 9.1.3 Service Pack 2.

NOTE: SAS initialization used:
      real time           1.86 seconds
      cpu time            0.33 seconds
      
1          /*********************************************
2          * Roy Pardee
3          * Center For Health Studies
4          * (206) 287-2078
5          * pardee.r@ghc.org
6          *
7          * \\groups\data\CTRHS\Crn\S D R C\VDW\Macros\TestPullContinuous2.sas
8          *
9          * Tests the %PullContinuous2() macro in the CRN standard macro
10         * library.
11         *********************************************/
12         
13         /* This is managed in the login script so that it doesnt
14            actually try to login when the machine is not connected
15            to the network */
16         %*include "\\home\pardre1\SAS\Scripts\dw_login.sas" ;
17         
18         options linesize = 150 nocenter msglevel = i NOOVP formchar='|-++++++++++=|-/|<>*' ;
19         
20         %include "\\groups\data\CTRHS\Crn\S D R C\VDW\Macros\StdVars.sas" ;
75         
76         *include "\\groups\data\CTRHS\Crn\S D R C\VDW\Macros\CRN_VDW_MACROS.sas" ;
77         filename crn_macs  FTP     "CRN_VDW_MACROS.sas"
78                            HOST  = "centerforhealthstudies.org"
79                            CD    = "/CRNSAS"
80                            PASS  = XXXXXXXXXXXXXXXXX
81                            USER  = "CRNReader" ;
82         
83         %include crn_macs ;
NOTE: 220 CHSORG Microsoft FTP Service (Version 5.0).
NOTE: User CRNReader has connected to FTP server  on Host centerforhealthstudies.org .
1554       
1555       
1556       libname s "c:\deleteme\" ;
NOTE: Libref S was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: c:\deleteme
2 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005

1557       
1558       /*
1559          The test call is:
1560             Index Date:                01-June-2003
1561             Pre-index enrollment:      12 months
1562             Pre-index gap tolerance:   1 month
1563             Post-index enrollment:     16 months
1564             Post-index gap tolerance:  2 months
1565       
1566             So period of interest runs from June 2002 through Jan 2005.
1567       
1568       */
1569       
1570       data test_people ;
1571       input MRN $ 1-10 expected_outcome $ 12-70 should_live $ 71-74 ;
1572       datalines ;

NOTE: The data set WORK.TEST_PEOPLE has 13 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.02 seconds
      

1586       ;
1587       run ;
1588       
1589       * Everybody starts out w/a full complement of data. ;
1590       data test_enroll ;
1591          set test_people ;
1592          do enr_year = 2001 to 2006 ;
1593             do enr_month = 1 to 12 ;
1594                enr_date = mdy(enr_month, 1, enr_year) ;
1595                output ;
1596             end ;
1597          end ;
1598          keep mrn enr_year enr_month enr_date ;
1599       run ;

NOTE: There were 13 observations read from the data set WORK.TEST_PEOPLE.
NOTE: The data set WORK.TEST_ENROLL has 936 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.05 seconds
      

1600       
1601       * Now we surgically remove some data to make gaps. ;
1602       proc sql ;
1603       
1604          * Bobby      No gaps at all.                                   ;
1605       
1606          * Johnny     One acceptable pre-index gap.                     ;
1607          delete from test_enroll
3 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005

1608          where MRN = 'Johnny' and
1609                enr_date in ('01Aug2002'd)
1610          ;
NOTE: 1 row was deleted from WORK.TEST_ENROLL.

1611          * Joey       Several acceptable post-index gaps.               ;
1612          delete from test_enroll
1613          where MRN = 'Joey' and
1614                enr_date in ('01Aug2003'd, '01Sep2003'd,
1615                             '01Dec2003'd, '01Jan2004'd,
1616                             '01Mar2004'd, '01Apr2004'd)
1617          ;
NOTE: 6 rows were deleted from WORK.TEST_ENROLL.

1618          * Dee-dee    One UNACCEPTABLE pre-index gap. ;
1619          delete from test_enroll
1620          where MRN = 'Dee-dee' and
1621                enr_date in ('01Aug2002'd, '01Sep2002'd)
1622          ;
NOTE: 2 rows were deleted from WORK.TEST_ENROLL.

1623          * PJ         One acceptable post-index gap.                    ;
1624          delete from test_enroll
1625          where MRN = 'PJ' and
1626                enr_date in ('01May2004'd, '01Jun2004'd)
1627          ;
NOTE: 2 rows were deleted from WORK.TEST_ENROLL.

1628          * Jean       One acceptable big gap straddling the index date. ;
1629          delete from test_enroll
1630          where MRN = 'Jean' and
1631                enr_date between '01May2003'd and '01Aug2003'd
1632          ;
NOTE: 4 rows were deleted from WORK.TEST_ENROLL.

1633       
1634          * Mark       All enrollment prior to period of interest UNACCEPTABLE. ;
1635          delete from test_enroll
1636          where MRN = 'Mark' and
1637                enr_date ge '01Jun2002'd
1638          ;
NOTE: 55 rows were deleted from WORK.TEST_ENROLL.

1639       
1640          * Jane       All enrollment after period of interest UNACCEPTABLE.   ;
1641          delete from test_enroll
1642          where MRN = 'Jane' and
1643                enr_date le '01Jan2005'd
1644          ;
NOTE: 49 rows were deleted from WORK.TEST_ENROLL.

1645          * Jose       One UNACCEPTABLE post-index gap.                        ;
1646          delete from test_enroll
4 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005

1647          where MRN = 'Jose' and
1648                enr_date in ('01Apr2004'd, '01May2004'd,
1649                             '01Jun2004'd)
1650          ;
NOTE: 3 rows were deleted from WORK.TEST_ENROLL.

1651          * Ann        A single record falling at the start of the pd          ;
1652          delete from test_enroll
1653          where MRN = 'Ann' and
1654                enr_date ne '01Jun1993'd
1655          ;
NOTE: 72 rows were deleted from WORK.TEST_ENROLL.

1656          * Don        One straddle-gap too big pre-index  ;
1657          delete from test_enroll
1658          where MRN = 'Don' and
1659                enr_date between '01Apr2003'd and '01Aug2003'd
1660          ;
NOTE: 5 rows were deleted from WORK.TEST_ENROLL.

1661          * Terry      One straddle-gap too big post-index ;
1662          delete from test_enroll
1663          where MRN = 'Terry' and
1664                enr_date between '01May2003'd and '01Sep2003'd
1665          ;
NOTE: 5 rows were deleted from WORK.TEST_ENROLL.

1666          * Roy        No enrollment after index + 1 month ;
1667          delete from test_enroll
1668          where MRN = 'Roy' and
1669                enr_date gt '01Jul2003'd
1670          ;
NOTE: 41 rows were deleted from WORK.TEST_ENROLL.

1671       quit ;
NOTE: PROCEDURE SQL used (Total process time):
      real time           1.19 seconds
      cpu time            0.22 seconds
      

1672       
1673       proc sql ;
1674          alter table test_people add primary key (MRN) ;
NOTE: Table WORK.TEST_PEOPLE has been modified, with 3 columns.
1675          alter table test_enroll add primary key (MRN, enr_year, enr_month) ;
NOTE: Table WORK.TEST_ENROLL has been modified, with 4 columns.
1676          alter table test_enroll add foreign key (MRN) references test_people ;
NOTE: Table WORK.TEST_ENROLL has been modified, with 4 columns.
1677       quit ;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.19 seconds
      cpu time            0.16 seconds
      
5 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005


1678       
1679       %PullContinuous2(InSet                   = test_people
1680                      , OutSet                  = survivors
1681                      , IndexDate               = '01Jun2003'd
1682                      , PreIndexEnrolledMonths  = 12
1683                      , PreIndexGapTolerance    = 1
1684                      , PostIndexEnrolledMonths = 16
1685                      , PostIndexGapTolerance   = 2
1686                      , EnrollDset              = test_enroll
1687                      , DebugOut                = s.testy
1688                      ) ;


==============================================================

Macro PullContinuous2a:

Creating a dataset "survivors", which will look exactly like
dataset "test_people", except that anyone not enrolled for 12
months prior to '01Jun2003'd (disregarding gaps of up to 1 month(s)) AND
16 months after '01Jun2003'd (disregarding gaps of up to 2 month(s)) will
be eliminated.

==============================================================


NOTE: Libref __ENROLL was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: \\ctrhs-sas\warehouse\sasdata\crn_vdw
NOTE: Table WORK.SURVIVORS created, with 0 rows and 3 columns.
NOTE: Statement transforms to:

        select E.MRN, MDY(E.enr_month, 1, E.enr_year) as EnrollDate format=MMDDYY10.0, 15857 as IDate format=MMDDYY10.0
          from WORK.TEST_ENROLL E inner join WORK.TEST_PEOPLE I on E.MRN=I.MRN
         where E.enr_year between 2002 and 2004;

NOTE: Table WORK._GRIST created, with 320 rows and 3 columns.

NOTE: Statement transforms to:

        delete
          from WORK._GRIST
         where _GRIST.EnrollDate not between INTNX('MONTH', _GRIST.IDate, -13) and INTNX('MONTH', _GRIST.IDate, 18);

NOTE: 44 rows were deleted from WORK._GRIST.

NOTE: Statement transforms to:

        select _GRIST.MRN
          from WORK._GRIST
      group by _GRIST.MRN
        having COUNT(*)>=((13+18)+1);
6 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005


NOTE: Table WORK._CONTINUOUSLY_ENROLLED created, with 1 rows and 1 columns.



1 people were continuously enrolled during the pre/post index date period of interest.


NOTE: Statement transforms to:

        insert
          into WORK.SURVIVORS(SURVIVORS.MRN, SURVIVORS.expected_outcome, SURVIVORS.should_live)
        select TEST_PEOPLE.MRN, TEST_PEOPLE.expected_outcome, TEST_PEOPLE.should_live
          from WORK.TEST_PEOPLE
         where TEST_PEOPLE.MRN in 
               ( select _CONTINUOUSLY_ENROLLED.MRN
                   from WORK._CONTINUOUSLY_ENROLLED
               );

NOTE: 1 row was inserted into WORK.SURVIVORS.

NOTE: Statement transforms to:

        delete
          from WORK._GRIST
         where _GRIST.MRN in 
               ( select _CONTINUOUSLY_ENROLLED.MRN
                   from WORK._CONTINUOUSLY_ENROLLED
               );

NOTE: 32 rows were deleted from WORK._GRIST.

NOTE: Table WORK._CONTINUOUSLY_ENROLLED has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.30 seconds
      cpu time            0.14 seconds
      


NOTE: There were 244 observations read from the data set WORK._GRIST.
NOTE: SAS sort was used.
NOTE: The data set WORK._GRIST has 244 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.02 seconds
      


NOTE: Missing values were generated as a result of performing an operation on missing values.
      Each place is given by: (Number of times) at (Line):(Column).
      1 at 1688:113   1 at 1688:151   
NOTE: There were 244 observations read from the data set WORK._GRIST.
NOTE: The data set S.TESTY has 244 observations and 7 variables.
7 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005

NOTE: The data set WORK._INSUFFICIENTLY_ENROLLED has 6 observations and 7 variables.
NOTE: DATA statement used (Total process time):
      real time           0.05 seconds
      cpu time            0.04 seconds
      

NOTE: 129 rows were deleted from WORK._GRIST.

NOTE: 4 rows were inserted into WORK.SURVIVORS.

NOTE: Table WORK._GRIST has been dropped.
NOTE: Table WORK._INSUFFICIENTLY_ENROLLED has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.05 seconds
      cpu time            0.04 seconds
      

NOTE: Libref __ENROLL has been deassigned.
1689       
1690       proc sql ;
1691       
1692          create table killed as
1693          select *
1694          from test_people
1695          except
1696          select *
1697          from survivors ;
NOTE: Table WORK.KILLED created, with 8 rows and 3 columns.

1698       
1699          title "Killed" ;
1700          select * from killed ;
1701       
1702          title "Survivors" ;
1703          select * from survivors ;
1704       
1705          create table failures as
1706          select *, 'Bogus survivor' as problem from survivors where should_live = 'NO'
1707          union all
1708          select *, 'Unjustly killed' from killed where should_live = 'Yes'
1709          ;
NOTE: Table WORK.FAILURES created, with 0 rows and 4 columns.

1710          title "Test Failures" ;
1711          select * from failures ;
NOTE: No rows were selected.
1712       quit ;
NOTE: The PROCEDURE SQL printed pages 1-2.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.21 seconds
      cpu time            0.10 seconds
      

8 The SAS System                                                                                                       11:40 Tuesday, November 8, 2005

1713       

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           7.00 seconds
      cpu time            1.41 seconds
      
